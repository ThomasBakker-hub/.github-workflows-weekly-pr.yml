name: Automated Issue Manager

on:
  schedule:
    - cron: '0 10 */3 * *' # هر ۳ روز یک‌بار، ساعت ۱۰ صبح
  workflow_dispatch:

jobs:
  manage-issues:
    runs-on: ubuntu-latest
    permissions:
      issues: write

    steps:
      - name: Create Issue
        run: |
          # ساخت یک Issue جدید با عنوان و متن تصادفی
          TITLE="Automated Maintenance Task #$(date +%s)"
          BODY="Running routine checks and updates. This is an automated task."
          
          # دستور ساخت Issue و ذخیره شماره آن
          ISSUE_URL=$(gh issue create --title "$TITLE" --body "$BODY")
          echo "CREATED_ISSUE_URL=$ISSUE_URL" >> $GITHUB_ENV
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Wait a bit
        run: sleep 60 # یک دقیقه صبر می‌کنه تا طبیعی‌تر به نظر بیاد

      - name: Close Issue
        run: |
          # بستن همون Issue که چند لحظه پیش ساختیم
          gh issue close $CREATED_ISSUE_URL --comment "Task completed successfully."
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
